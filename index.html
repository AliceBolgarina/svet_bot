<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–í—ã–±–æ—Ä –ø—É–Ω–∫—Ç–∞ –≤—ã–¥–∞—á–∏</title>
    
    <!-- –Ø–Ω–¥–µ–∫—Å –≤–∏–¥–∂–µ—Ç -->
    <script src="https://ndd-widget.landpro.site/widget.js"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { height: 100vh; overflow: hidden; font-family: Arial, sans-serif; }
        
        #widget-container {
            width: 100%;
            height: 100vh;
        }
        
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 12px;
            text-align: center;
            border-bottom: 1px solid #ddd;
            z-index: 1000;
        }
        
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
    </style>
</head>
<body>
    <div class="header">
        <h3>–í—ã–±–µ—Ä–∏—Ç–µ –ø—É–Ω–∫—Ç –≤—ã–¥–∞—á–∏</h3>
        <p>–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –º–µ—Ç–∫—É –Ω–∞ –∫–∞—Ä—Ç–µ</p>
    </div>
    
    <div id="widget-container"></div>
    <div class="loading" id="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>

    <script>
        console.log('üöÄ –ó–∞–ø—É—Å–∫...');
        
        // Telegram Web App
        if (window.Telegram && Telegram.WebApp) {
            Telegram.WebApp.expand();
            Telegram.WebApp.ready();
        }
        
        // –°–æ–∑–¥–∞–µ–º –≤–∏–¥–∂–µ—Ç
        function createWidget() {
            console.log('–°–æ–∑–¥–∞–Ω–∏–µ –≤–∏–¥–∂–µ—Ç–∞...');
            
            try {
                const widget = YaDelivery.createWidget({
                    containerId: 'widget-container',
                    params: {
                        city: "–ú–æ—Å–∫–≤–∞",
                        size: { height: "100%", width: "100%" },
                        show_select_button: true,
                        filter: { type: ["pickup_point"] }
                    }
                });
                
                console.log('‚úÖ –í–∏–¥–∂–µ—Ç —Å–æ–∑–¥–∞–Ω');
                
                // –°–æ–±—ã—Ç–∏–µ –≤—ã–±–æ—Ä–∞ –ü–í–ó
                document.addEventListener('YaNddWidgetPointSelected', function(e) {
                    console.log('–í—ã–±—Ä–∞–Ω –ü–í–ó:', e.detail);
                    
                    const pvz = e.detail;
                    const data = {
                        action: 'pvz_selected',
                        pvz_id: pvz.id,
                        pvz_name: pvz.name,
                        pvz_address: pvz.address.full_address
                    };
                    
                    console.log('–û—Ç–ø—Ä–∞–≤–∫–∞:', data);
                    
                    if (window.Telegram && Telegram.WebApp) {
                        Telegram.WebApp.sendData(JSON.stringify(data));
                        setTimeout(() => Telegram.WebApp.close(), 200);
                    }
                });
                
                document.getElementById('loading').style.display = 'none';
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞:', error);
                document.getElementById('loading').textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ä—Ç—ã';
            }
        }
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º
        if (window.YaDelivery) {
            createWidget();
        } else {
            document.addEventListener('YaNddWidgetLoad', createWidget);
            
            // –¢–∞–π–º–∞—É—Ç
            setTimeout(() => {
                if (document.getElementById('loading').style.display !== 'none') {
                    document.getElementById('loading').textContent = '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∫–∞—Ä—Ç—É. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.';
                }
            }, 10000);
        }
    </script>
</body>
</html>
