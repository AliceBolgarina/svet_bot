<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–í—ã–±–æ—Ä –ü–í–ó - –†–∞—Å—Å–µ—è–Ω–Ω—ã–π —Å–≤–µ—Ç</title>
    <!-- –Ø–Ω–¥–µ–∫—Å –≤–∏–¥–∂–µ—Ç -->
    <script async src="https://ndd-widget.landpro.site/widget.js"></script>
    <style>
        /* –°—Ç–∏–ª–∏ –∫–∞–∫ –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–º –≤–∞—Ä–∏–∞–Ω—Ç–µ, –Ω–æ –¥–æ–±–∞–≤–∏–º */
        .yandex-widget-btn {
            background: linear-gradient(135deg, #FF0000 0%, #CC0000 100%);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 18px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin: 10px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .widget-container {
            display: none;
            margin: 20px 0;
            height: 400px;
            border-radius: 12px;
            overflow: hidden;
            border: 2px solid #e9ecef;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üó∫Ô∏è –í—ã–±–æ—Ä –ø—É–Ω–∫—Ç–∞ –≤—ã–¥–∞—á–∏</h1>
            <p>–Ø–Ω–¥–µ–∫—Å.–î–æ—Å—Ç–∞–≤–∫–∞ ‚Ä¢ –ë–µ—Å–ø–ª–∞—Ç–Ω–æ –æ—Ç 3000‚ÇΩ</p>
        </div>
        
        <!-- –í–∞—Ä–∏–∞–Ω—Ç 1: –Ø–Ω–¥–µ–∫—Å –∫–∞—Ä—Ç–∞ -->
        <button class="yandex-widget-btn" id="yandexBtn">
            <span>üîç –û—Ç–∫—Ä—ã—Ç—å –Ø–Ω–¥–µ–∫—Å –∫–∞—Ä—Ç—É</span>
        </button>
        
        <div class="widget-container" id="yandexWidget">
            <div id="delivery-widget" style="height: 100%;"></div>
        </div>
        
        <!-- –ò–ª–∏ -->
        <div class="instruction" style="text-align: center; margin: 20px 0;">
            <strong>‚Äì‚Äì –ò–õ–ò ‚Äì‚Äì</strong><br>
            <span style="color: #666; font-size: 14px;">–í—ã–±–µ—Ä–∏—Ç–µ –∏–∑ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö:</span>
        </div>
        
        <!-- –í–∞—Ä–∏–∞–Ω—Ç 2: –°–ø–∏—Å–æ–∫ –ü–í–ó -->
        <div class="pvz-options" id="pvzOptions">
            <!-- –°–ø–∏—Å–æ–∫ –ü–í–ó –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
        </div>
        
        <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
        <button class="button" id="confirmButton" disabled>
            <span>‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –≤—ã–±–æ—Ä</span>
        </button>
        
        <div class="status" id="statusMessage"></div>
    </div>
    
    <script>
        // –î–∞–Ω–Ω—ã–µ –ü–í–ó (–º–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å)
        const pvzList = [
            {
                id: 'pvz_msk_tverskaya',
                name: '–ü—É–Ω–∫—Ç –≤—ã–¥–∞—á–∏ –Ω–∞ –¢–≤–µ—Ä—Å–∫–æ–π',
                address: '–ú–æ—Å–∫–≤–∞, —É–ª. –¢–≤–µ—Ä—Å–∫–∞—è, –¥. 10',
                hours: '09:00-21:00 –µ–∂–µ–¥–Ω–µ–≤–Ω–æ',
                phone: '+7 (495) 111-22-33',
                yandex_id: 'optional_id_1'
            },
            {
                id: 'pvz_msk_arbat',
                name: '–ü—É–Ω–∫—Ç –≤—ã–¥–∞—á–∏ –Ω–∞ –ê—Ä–±–∞—Ç–µ', 
                address: '–ú–æ—Å–∫–≤–∞, —É–ª. –ê—Ä–±–∞—Ç, –¥. 25',
                hours: '10:00-22:00 –µ–∂–µ–¥–Ω–µ–≤–Ω–æ',
                phone: '+7 (495) 222-33-44',
                yandex_id: 'optional_id_2'
            },
            {
                id: 'pvz_spb_nevsky',
                name: '–ü—É–Ω–∫—Ç –≤—ã–¥–∞—á–∏ –Ω–∞ –ù–µ–≤—Å–∫–æ–º',
                address: '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥, –ù–µ–≤—Å–∫–∏–π –ø—Ä., –¥. 50',
                hours: '08:00-20:00 –µ–∂–µ–¥–Ω–µ–≤–Ω–æ',
                phone: '+7 (812) 333-44-55',
                yandex_id: 'optional_id_3'
            }
        ];
        
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let selectedPVZ = null;
        let isTelegram = false;
        let yandexWidgetInitialized = false;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º Telegram Web App
            if (window.Telegram && window.Telegram.WebApp) {
                isTelegram = true;
                initTelegramWebApp();
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –ü–í–ó
            loadPVZOptions();
            
            // –ù–∞–∑–Ω–∞—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
            document.getElementById('yandexBtn').addEventListener('click', toggleYandexWidget);
            document.getElementById('confirmButton').addEventListener('click', confirmSelection);
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ø–Ω–¥–µ–∫—Å –≤–∏–¥–∂–µ—Ç–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
            initYandexWidget();
        });
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ø–Ω–¥–µ–∫—Å –≤–∏–¥–∂–µ—Ç–∞
        function initYandexWidget() {
            if (yandexWidgetInitialized) return;
            
            // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –Ø–Ω–¥–µ–∫—Å
            if (window.YaDelivery) {
                createYandexWidget();
            } else {
                document.addEventListener('YaNddWidgetLoad', createYandexWidget);
            }
        }
        
        function createYandexWidget() {
            try {
                window.YaDelivery.createWidget({
                    containerId: 'delivery-widget',
                    params: {
                        city: "–ú–æ—Å–∫–≤–∞",
                        size: { height: "400px", width: "100%" },
                        source_platform_station: "05e809bb-4521-42d9-a936-0fb0744c0fb3",
                        physical_dims_weight_gross: 2000,
                        delivery_price: "300 —Ä—É–±.",
                        delivery_term: "2-4 –¥–Ω—è",
                        show_select_button: true,
                        filter: {
                            type: ["pickup_point", "terminal"],
                            is_yandex_branded: false,
                            payment_methods: ["already_paid", "card_on_receipt"],
                            payment_methods_filter: "or"
                        }
                    }
                });
                
                // –°–ª—É—à–∞—Ç–µ–ª—å –≤—ã–±–æ—Ä–∞ –ü–í–ó –Ω–∞ –∫–∞—Ä—Ç–µ
                document.addEventListener('YaNddWidgetPointSelected', function(event) {
                    const yandexPVZ = event.detail;
                    handleYandexPVZSelection(yandexPVZ);
                });
                
                yandexWidgetInitialized = true;
                console.log('‚úÖ –Ø–Ω–¥–µ–∫—Å –≤–∏–¥–∂–µ—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –Ø–Ω–¥–µ–∫—Å –≤–∏–¥–∂–µ—Ç–∞:', error);
                showStatus('‚ö†Ô∏è –ö–∞—Ä—Ç–∞ –Ø–Ω–¥–µ–∫—Å –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞. –í—ã–±–µ—Ä–∏—Ç–µ –∏–∑ —Å–ø–∏—Å–∫–∞ –Ω–∏–∂–µ.', 'error');
            }
        }
        
        function handleYandexPVZSelection(yandexPVZ) {
            selectedPVZ = {
                id: yandexPVZ.id,
                name: yandexPVZ.name,
                address: yandexPVZ.address.full_address,
                working_hours: yandexPVZ.working_hours || '',
                phone: yandexPVZ.phone || '',
                source: 'yandex_widget'
            };
            
            // –í–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
            const confirmBtn = document.getElementById('confirmButton');
            confirmBtn.disabled = false;
            confirmBtn.innerHTML = `<span>‚úÖ –í—ã–±—Ä–∞–Ω–æ –Ω–∞ –∫–∞—Ä—Ç–µ: ${selectedPVZ.name.substring(0, 25)}...</span>`;
            
            showStatus(`üìç –í—ã–±—Ä–∞–Ω –ü–í–ó –Ω–∞ –∫–∞—Ä—Ç–µ: ${selectedPVZ.name}`, 'success');
        }
        
        function toggleYandexWidget() {
            const widget = document.getElementById('yandexWidget');
            const btn = document.getElementById('yandexBtn');
            
            if (widget.style.display === 'block') {
                widget.style.display = 'none';
                btn.innerHTML = '<span>üîç –û—Ç–∫—Ä—ã—Ç—å –Ø–Ω–¥–µ–∫—Å –∫–∞—Ä—Ç—É</span>';
            } else {
                widget.style.display = 'block';
                btn.innerHTML = '<span>‚ùå –°–∫—Ä—ã—Ç—å –∫–∞—Ä—Ç—É</span>';
                
                // –ü—Ä–æ–∫—Ä—É—Ç–∏—Ç—å –∫ –≤–∏–¥–∂–µ—Ç—É
                widget.scrollIntoView({ behavior: 'smooth' });
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –ü–í–ó (–∫–∞–∫ —Ä–∞–Ω—å—à–µ)
        function loadPVZOptions() {
            const container = document.getElementById('pvzOptions');
            container.innerHTML = '';
            
            pvzList.forEach((pvz, index) => {
                const div = document.createElement('div');
                div.className = 'pvz-option';
                div.dataset.id = pvz.id;
                div.dataset.index = index;
                
                div.innerHTML = `
                    <div class="pvz-icon">üì¶</div>
                    <div class="pvz-info">
                        <div class="pvz-name">${pvz.name}</div>
                        <div class="pvz-address">${pvz.address}</div>
                        <div class="pvz-hours">üïí ${pvz.hours}</div>
                    </div>
                `;
                
                div.addEventListener('click', () => selectPVZFromList(index));
                container.appendChild(div);
            });
        }
        
        function selectPVZFromList(index) {
            selectedPVZ = pvzList[index];
            
            // –í—ã–¥–µ–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π
            document.querySelectorAll('.pvz-option').forEach(el => {
                el.classList.remove('selected');
            });
            document.querySelector(`.pvz-option[data-index="${index}"]`).classList.add('selected');
            
            // –í–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
            const confirmBtn = document.getElementById('confirmButton');
            confirmBtn.disabled = false;
            confirmBtn.innerHTML = `<span>‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å: ${selectedPVZ.name.substring(0, 20)}...</span>`;
            
            showStatus(`üìç –í—ã–±—Ä–∞–Ω–æ: ${selectedPVZ.name}`, 'info');
        }
        
        function confirmSelection() {
            if (!selectedPVZ) {
                showStatus('‚ùå –°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –ø—É–Ω–∫—Ç –≤—ã–¥–∞—á–∏', 'error');
                return;
            }
            
            const pvzData = {
                action: 'pvz_selected',
                pvz_id: selectedPVZ.id,
                pvz_name: selectedPVZ.name,
                pvz_address: selectedPVZ.address,
                pvz_working_hours: selectedPVZ.hours || selectedPVZ.working_hours || '',
                pvz_phone: selectedPVZ.phone || '',
                selected_from: selectedPVZ.source || 'list',
                timestamp: Date.now()
            };
            
            sendDataToTelegram(pvzData);
        }
        
        function sendDataToTelegram(data) {
            console.log('üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ Telegram:', data);
            
            showStatus('üîÑ –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö...', 'info');
            
            if (isTelegram && window.Telegram.WebApp) {
                // –í–∞–∂–Ω–æ: –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –°–¢–†–û–ö–£ JSON
                const dataString = JSON.stringify(data);
                console.log('üìÑ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º–∞—è —Å—Ç—Ä–æ–∫–∞:', dataString);
                
                window.Telegram.WebApp.sendData(dataString);
                
                showStatus('‚úÖ –î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã! –ó–∞–∫—Ä—ã–≤–∞–µ–º...', 'success');
                
                // –î–∞–µ–º –≤—Ä–µ–º—è –Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫—É
                setTimeout(() => {
                    window.Telegram.WebApp.close();
                }, 1000);
                
            } else {
                // –†–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏
                const dataString = JSON.stringify(data, null, 2);
                showStatus(`üìã –î–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏:<br><pre>${dataString}</pre>`, 'success');
                alert('–í–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –≤ Telegram. –î–∞–Ω–Ω—ã–µ:\n' + dataString);
            }
        }
        
        function showStatus(message, type) {
            const statusEl = document.getElementById('statusMessage');
            statusEl.innerHTML = message;
            statusEl.className = 'status ' + (type || '');
            statusEl.style.display = 'block';
            
            if (type !== 'info') {
                setTimeout(() => statusEl.style.display = 'none', 5000);
            }
        }
        
        function initTelegramWebApp() {
            const tg = window.Telegram.WebApp;
            tg.expand();
            tg.setHeaderColor('#667eea');
            tg.setBackgroundColor('#ffffff');
            tg.ready();
            
            // –ö–Ω–æ–ø–∫–∞ –Ω–∞–∑–∞–¥
            tg.BackButton.show();
            tg.BackButton.onClick(() => tg.close());
            
            console.log('‚úÖ Telegram Web App –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
        }
    </script>
</body>
</html>
