<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–í—ã–±–æ—Ä –ø—É–Ω–∫—Ç–∞ –≤—ã–¥–∞—á–∏</title>
    
    <!-- –Ø–Ω–¥–µ–∫—Å –≤–∏–¥–∂–µ—Ç -->
    <script src="https://ndd-widget.landpro.site/widget.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            height: 100vh;
            overflow: hidden;
            background: white;
        }
        
        .header {
            background: white;
            padding: 16px;
            text-align: center;
            border-bottom: 1px solid #e0e0e0;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }
        
        .header h1 {
            font-size: 18px;
            color: #333;
            margin-bottom: 4px;
        }
        
        .header p {
            font-size: 14px;
            color: #666;
        }
        
        /* –ö–û–ù–¢–ï–ô–ù–ï–† –ö–ê–†–¢–´ - –¥–µ–ª–∞–µ–º —É–∑–∫–∏–º –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ */
        .map-container {
            position: fixed;
            top: 80px;
            left: 0;
            right: 0;
            bottom: 0;
            /* –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —Å—É–∂–∞–µ–º –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ */
            max-width: 400px;
            margin: 0 auto;
        }
        
        #widget-container {
            width: 100%;
            height: 100%;
        }
        
        /* –°–∫—Ä—ã–≤–∞–µ–º —Å–∞–π–¥–±–∞—Ä –Ø–Ω–¥–µ–∫—Å–∞ */
        .yandex-delivery-widget .sidebar {
            display: none !important;
        }
        
        /* –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —Å–∫—Ä—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫ –ü–í–ó */
        [class*="point-list"], [class*="list-container"] {
            display: none !important;
        }
        
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 16px;
            color: #666;
        }
        
        /* –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è */
        .instruction {
            position: absolute;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: white;
            padding: 12px;
            border-radius: 10px;
            text-align: center;
            font-size: 14px;
            color: #333;
            border: 2px solid #667eea;
            z-index: 100;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>–í—ã–±–µ—Ä–∏—Ç–µ –ø—É–Ω–∫—Ç –≤—ã–¥–∞—á–∏</h1>
        <p>–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –º–µ—Ç–∫—É –Ω–∞ –∫–∞—Ä—Ç–µ</p>
    </div>
    
    <div class="map-container">
        <div id="widget-container"></div>
        <div class="loading" id="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ä—Ç—ã...</div>
        <div class="instruction" id="instruction">
            üëÜ –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –º–µ—Ç–∫—É –ü–í–ó –Ω–∞ –∫–∞—Ä—Ç–µ, –∑–∞—Ç–µ–º –∫–Ω–æ–ø–∫—É "–í—ã–±—Ä–∞—Ç—å —ç—Ç–æ—Ç –ø—É–Ω–∫—Ç"
        </div>
    </div>

    <script>
        // Telegram Web App
        function initTelegram() {
            if (window.Telegram && Telegram.WebApp) {
                Telegram.WebApp.expand();
                Telegram.WebApp.ready();
                console.log('‚úÖ Telegram Web App –≥–æ—Ç–æ–≤');
            }
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –Ø–Ω–¥–µ–∫—Å –≤–∏–¥–∂–µ—Ç–∞
        function createYandexWidget() {
            console.log('üõ†Ô∏è –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏–¥–∂–µ—Ç–∞...');
            
            try {
                // –¢–µ—Å—Ç–æ–≤—ã–π station_id –¥–ª—è –ú–æ—Å–∫–≤—ã
                const testStationId = "05e809bb-4521-42d9-a936-0fb0744c0fb3";
                
                // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
                window.yandexWidget = YaDelivery.createWidget({
                    containerId: 'widget-container',
                    params: {
                        city: "–ú–æ—Å–∫–≤–∞",
                        size: { height: "100%", width: "100%" },
                        source_platform_station: testStationId,
                        physical_dims_weight_gross: 1000,
                        delivery_price: "–æ—Ç 300 ‚ÇΩ",
                        delivery_term: "1-3 –¥–Ω—è",
                        show_select_button: true,
                        filter: {
                            type: ["pickup_point"],
                            is_yandex_branded: false,
                            payment_methods: ["already_paid", "card_on_receipt"]
                        },
                        // –ü–∞—Ä–∞–º–µ—Ç—Ä –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ –≤–∏–¥–∞ (–µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è)
                        view: "mobile"
                    }
                });
                
                console.log('‚úÖ –í–∏–¥–∂–µ—Ç —Å–æ–∑–¥–∞–Ω');
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ –ü–í–ó
                document.addEventListener('YaNddWidgetPointSelected', function(event) {
                    console.log('üìç –í—ã–±–æ—Ä –ü–í–ó:', event.detail);
                    
                    if (!event.detail) return;
                    
                    const pvz = event.detail;
                    
                    // –¢–æ–ª—å–∫–æ –æ—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                    const data = {
                        action: 'pvz_selected',
                        pvz_id: pvz.id,
                        pvz_name: pvz.name || '–ü—É–Ω–∫—Ç –≤—ã–¥–∞—á–∏',
                        pvz_address: pvz.address?.full_address || pvz.address || '',
                        pvz_working_hours: pvz.working_hours || '',
                        pvz_phone: pvz.phone || ''
                    };
                    
                    console.log('üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö:', data);
                    
                    // –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram
                    if (window.Telegram && Telegram.WebApp) {
                        Telegram.WebApp.sendData(JSON.stringify(data));
                        // –°–∫—Ä—ã–≤–∞–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é
                        document.getElementById('instruction').style.display = 'none';
                        // –ó–∞–∫—Ä—ã–≤–∞–µ–º
                        setTimeout(() => {
                            try {
                                Telegram.WebApp.close();
                            } catch (e) {
                                // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º
                            }
                        }, 200);
                    } else {
                        // –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º
                        console.log('–¢–µ—Å—Ç: –¥–∞–Ω–Ω—ã–µ –≥–æ—Ç–æ–≤—ã', data);
                        document.getElementById('instruction').textContent = '‚úÖ –ü—É–Ω–∫—Ç –≤—ã–±—Ä–∞–Ω! –í Telegram –¥–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤—è—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.';
                    }
                });
                
                // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —Å–∫—Ä—ã–≤–∞–µ–º —Å–∞–π–¥–±–∞—Ä –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
                setTimeout(() => {
                    document.getElementById('loading').style.display = 'none';
                    hideYandexSidebar();
                }, 1500);
                
                // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã–≤–∞–µ–º —Å–∞–π–¥–±–∞—Ä
                setInterval(hideYandexSidebar, 1000);
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –≤–∏–¥–∂–µ—Ç–∞:', error);
                document.getElementById('loading').textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ä—Ç—ã';
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–∫—Ä—ã—Ç–∏—è —Å–∞–π–¥–±–∞—Ä–∞ –Ø–Ω–¥–µ–∫—Å–∞
        function hideYandexSidebar() {
            const widget = document.querySelector('#widget-container .yandex-delivery-widget');
            if (widget) {
                // –ò—â–µ–º –∏ —Å–∫—Ä—ã–≤–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã —Å–ø–∏—Å–∫–∞ –ü–í–ó
                const sidebars = widget.querySelectorAll('.sidebar, [class*="list"], [class*="points"]');
                sidebars.forEach(el => {
                    if (el.offsetWidth > 100) { // –ï—Å–ª–∏ —ç—Ç–æ —Å–∞–π–¥–±–∞—Ä (—à–∏—Ä–æ–∫–∏–π —ç–ª–µ–º–µ–Ω—Ç)
                        el.style.display = 'none';
                    }
                });
                
                // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∏–¥–∞
                const toggleButtons = widget.querySelectorAll('[class*="toggle"], [class*="view"]');
                toggleButtons.forEach(btn => {
                    btn.style.display = 'none';
                });
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        function init() {
            console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...');
            
            // Telegram
            initTelegram();
            
            // –Ø–Ω–¥–µ–∫—Å –≤–∏–¥–∂–µ—Ç
            if (typeof YaDelivery !== 'undefined') {
                createYandexWidget();
            } else {
                // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
                document.addEventListener('YaNddWidgetLoad', createYandexWidget);
            }
        }
        
        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', init);
        
        // –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
        window.addEventListener('resize', function() {
            hideYandexSidebar();
        });
    </script>
</body>
</html>
