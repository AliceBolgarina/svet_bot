<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–í—ã–±–æ—Ä –ø—É–Ω–∫—Ç–∞ –≤—ã–¥–∞—á–∏</title>
    
    <!-- –Ø–Ω–¥–µ–∫—Å –≤–∏–¥–∂–µ—Ç -->
    <script src="https://ndd-widget.landpro.site/widget.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            height: 100vh;
            overflow: hidden;
            background: white;
        }
        
        .header {
            background: white;
            padding: 16px;
            text-align: center;
            border-bottom: 1px solid #e0e0e0;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }
        
        .header h1 {
            font-size: 18px;
            color: #333;
            margin-bottom: 4px;
        }
        
        .header p {
            font-size: 14px;
            color: #666;
        }
        
        .map-container {
            position: fixed;
            top: 80px;
            left: 0;
            right: 0;
            bottom: 0;
        }
        
        #widget-container {
            width: 100%;
            height: 100%;
        }
        
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 16px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>–í—ã–±–µ—Ä–∏—Ç–µ –ø—É–Ω–∫—Ç –≤—ã–¥–∞—á–∏</h1>
        <p>–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –º–µ—Ç–∫—É –Ω–∞ –∫–∞—Ä—Ç–µ</p>
    </div>
    
    <div class="map-container">
        <div id="widget-container"></div>
        <div class="loading" id="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ä—Ç—ã...</div>
    </div>

    <script>
        // Telegram Web App
        function initTelegram() {
            if (window.Telegram && Telegram.WebApp) {
                Telegram.WebApp.expand();
                Telegram.WebApp.ready();
                console.log('‚úÖ Telegram Web App –≥–æ—Ç–æ–≤');
            }
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –Ø–Ω–¥–µ–∫—Å –≤–∏–¥–∂–µ—Ç–∞
        function createYandexWidget() {
            console.log('üõ†Ô∏è –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏–¥–∂–µ—Ç–∞...');
            
            try {
                // –¢–µ—Å—Ç–æ–≤—ã–π station_id –¥–ª—è –ú–æ—Å–∫–≤—ã
                const testStationId = "05e809bb-4521-42d9-a936-0fb0744c0fb3";
                
                // –í–∞—Ä–∏–∞–Ω—Ç 1: –° –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
               window.yandexWidget = YaDelivery.createWidget({
                    containerId: 'widget-container',
                    params: {
                        city: "–ú–æ—Å–∫–≤–∞",
                        size: { height: "100%", width: "100%" },
                        source_platform_station: "05e809bb-4521-42d9-a936-0fb0744c0fb3",
                        physical_dims_weight_gross: 1000,
                        delivery_price: "–æ—Ç 300 ‚ÇΩ", // –£–∫–∞–∑—ã–≤–∞–µ–º —Ü–µ–Ω—É (–º–æ–∂–µ—Ç –±—ã—Ç—å –≤–∞–∂–Ω–æ –¥–ª—è –∫–Ω–æ–ø–∫–∏)
                        delivery_term: "–æ—Ç 1 –¥–Ω—è",  // –£–∫–∞–∑—ã–≤–∞–µ–º —Å—Ä–æ–∫
                        show_select_button: true,
                        filter: {
                            type: ["pickup_point", "terminal"],
                            is_yandex_branded: false,
                            payment_methods: ["already_paid", "card_on_receipt"],
                            payment_methods_filter: "or"
                        }
                    }
                });
                
                console.log('‚úÖ –í–∏–¥–∂–µ—Ç —Å–æ–∑–¥–∞–Ω');
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ –ü–í–ó
                document.addEventListener('YaNddWidgetPointSelected', function(event) {
                    console.log('üìç –í—ã–±–æ—Ä –ü–í–ó:', event.detail);
                    
                    if (!event.detail) return;
                    
                    const pvz = event.detail;
                    
                    // –¢–æ–ª—å–∫–æ –æ—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                    const data = {
                        action: 'pvz_selected',
                        pvz_id: pvz.id,
                        pvz_name: pvz.name || '–ü—É–Ω–∫—Ç –≤—ã–¥–∞—á–∏',
                        pvz_address: pvz.address?.full_address || pvz.address || ''
                    };
                    
                    console.log('üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö:', data);
                    
                    // –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram
                    if (window.Telegram && Telegram.WebApp) {
                        Telegram.WebApp.sendData(JSON.stringify(data));
                        // –ó–∞–∫—Ä—ã–≤–∞–µ–º –±–µ–∑ –∞–ª–µ—Ä—Ç–æ–≤
                        setTimeout(() => {
                            try {
                                Telegram.WebApp.close();
                            } catch (e) {
                                // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫—É –∑–∞–∫—Ä—ã—Ç–∏—è
                            }
                        }, 200);
                    } else {
                        // –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º
                        console.log('–¢–µ—Å—Ç: –¥–∞–Ω–Ω—ã–µ –≥–æ—Ç–æ–≤—ã', data);
                    }
                });
                
                // –°–∫—Ä—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
                setTimeout(() => {
                    document.getElementById('loading').style.display = 'none';
                }, 1000);
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –≤–∏–¥–∂–µ—Ç–∞:', error);
                document.getElementById('loading').textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ä—Ç—ã';
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        function init() {
            console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...');
            
            // Telegram
            initTelegram();
            
            // –Ø–Ω–¥–µ–∫—Å –≤–∏–¥–∂–µ—Ç
            if (typeof YaDelivery !== 'undefined') {
                createYandexWidget();
            } else {
                // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
                document.addEventListener('YaNddWidgetLoad', createYandexWidget);
                
                // –¢–∞–π–º–∞—É—Ç
                setTimeout(() => {
                    if (document.getElementById('loading').style.display !== 'none') {
                        document.getElementById('loading').textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏';
                    }
                }, 8000);
            }
        }
        
        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
