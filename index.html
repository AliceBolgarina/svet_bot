<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–í—ã–±–æ—Ä –ø—É–Ω–∫—Ç–∞ –≤—ã–¥–∞—á–∏</title>
    
    <!-- –Ø–Ω–¥–µ–∫—Å –≤–∏–¥–∂–µ—Ç -->
    <script src="https://ndd-widget.landpro.site/widget.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            height: 100vh;
            overflow: hidden;
            background: white;
        }
        
        .header {
            background: white;
            padding: 16px;
            text-align: center;
            border-bottom: 1px solid #e0e0e0;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }
        
        .header h1 {
            font-size: 18px;
            color: #333;
            margin-bottom: 4px;
        }
        
        .header p {
            font-size: 14px;
            color: #666;
        }
        
        .map-container {
            position: fixed;
            top: 80px;
            left: 0;
            right: 0;
            bottom: 0;
        }
        
        #widget-container {
            width: 100%;
            height: 100%;
        }
        
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 16px;
            color: #666;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>–í—ã–±–µ—Ä–∏—Ç–µ –ø—É–Ω–∫—Ç –≤—ã–¥–∞—á–∏</h1>
        <p>–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –º–µ—Ç–∫—É –Ω–∞ –∫–∞—Ä—Ç–µ</p>
    </div>
    
    <div class="map-container">
        <div id="widget-container"></div>
        <div class="loading" id="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ä—Ç—ã...</div>
    </div>

    <script>
        // Telegram Web App
        function initTelegram() {
            if (window.Telegram && Telegram.WebApp) {
                Telegram.WebApp.expand();
                Telegram.WebApp.setHeaderColor('#ffffff');
                Telegram.WebApp.setBackgroundColor('#ffffff');
                Telegram.WebApp.ready();
                console.log('‚úÖ Telegram Web App –≥–æ—Ç–æ–≤');
            }
        }
        
        // –Ø–Ω–¥–µ–∫—Å –≤–∏–¥–∂–µ—Ç
        function initYandexWidget() {
            console.log('üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ –Ø–Ω–¥–µ–∫—Å –≤–∏–¥–∂–µ—Ç–∞...');
            
            if (typeof YaDelivery !== 'undefined') {
                createWidget();
            } else {
                document.addEventListener('YaNddWidgetLoad', createWidget);
                
                setTimeout(() => {
                    if (document.getElementById('loading').style.display !== 'none') {
                        document.getElementById('loading').textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ä—Ç—ã';
                    }
                }, 10000);
            }
        }
        
        function createWidget() {
            try {
                console.log('üõ†Ô∏è –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏–¥–∂–µ—Ç–∞...');
                
                // –í–ê–ñ–ù–û: –Ω—É–∂–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π source_platform_station!
                // –≠—Ç–æ ID —Å—Ç–∞–Ω—Ü–∏–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ —Å–∏—Å—Ç–µ–º–µ –Ø–Ω–¥–µ–∫—Å.–î–æ—Å—Ç–∞–≤–∫–∏
                // –î–ª—è —Ç–µ—Å—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞–Ω—Ü–∏—é –≤ –ú–æ—Å–∫–≤–µ:
                const stationId = "05e809bb-4521-42d9-a936-0fb0744c0fb3"; // –ü—Ä–∏–º–µ—Ä ID
                
                // –ï—Å–ª–∏ —É –≤–∞—Å —Å–≤–æ–π station_id, –∑–∞–º–µ–Ω–∏—Ç–µ –µ–≥–æ:
                // const stationId = "–í–ê–®_STATION_ID";
                
                window.yandexWidget = YaDelivery.createWidget({
                    containerId: 'widget-container',
                    params: {
                        city: "–ú–æ—Å–∫–≤–∞",
                        size: {
                            height: "100%",
                            width: "100%"
                        },
                        // –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–´–ï –ü–ê–†–ê–ú–ï–¢–†–´:
                        source_platform_station: stationId, // ID —Å—Ç–∞–Ω—Ü–∏–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è
                        physical_dims_weight_gross: 1000,   // –í–µ—Å –≤ –≥—Ä–∞–º–º–∞—Ö (–º–∏–Ω–∏–º—É–º 1000)
                        delivery_price: "300 ‚ÇΩ",            // –°—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏
                        delivery_term: "2-4 –¥–Ω—è",           // –°—Ä–æ–∫ –¥–æ—Å—Ç–∞–≤–∫–∏
                        show_select_button: true,           // –ö–Ω–æ–ø–∫–∞ –≤—ã–±–æ—Ä–∞ (–î–û–õ–ñ–ù–ê –±—ã—Ç—å true)
                        filter: {
                            type: ["pickup_point"],         // –¢–æ–ª—å–∫–æ –ø—É–Ω–∫—Ç—ã –≤—ã–¥–∞—á–∏
                            is_yandex_branded: false,       // –í—Å–µ –ü–í–ó
                            payment_methods: ["already_paid", "card_on_receipt"],
                            payment_methods_filter: "or"
                        }
                    }
                });
                
                console.log('‚úÖ –í–∏–¥–∂–µ—Ç —Å–æ–∑–¥–∞–Ω —Å station_id:', stationId);
                
                // –°–æ–±—ã—Ç–∏–µ –≤—ã–±–æ—Ä–∞ –ü–í–ó
                document.addEventListener('YaNddWidgetPointSelected', function(event) {
                    console.log('üìç –í—ã–±–æ—Ä –ü–í–ó:', event.detail);
                    
                    if (!event.detail) return;
                    
                    const pvz = event.detail;
                    const data = {
                        action: 'pvz_selected',
                        pvz_id: pvz.id || '',
                        pvz_name: pvz.name || '–ü—É–Ω–∫—Ç –≤—ã–¥–∞—á–∏',
                        pvz_address: pvz.address?.full_address || '',
                        pvz_working_hours: pvz.working_hours || '',
                        pvz_phone: pvz.phone || ''
                    };
                    
                    console.log('üì§ –û—Ç–ø—Ä–∞–≤–∫–∞:', data);
                    
                    if (window.Telegram && Telegram.WebApp) {
                        Telegram.WebApp.sendData(JSON.stringify(data));
                        setTimeout(() => {
                            try {
                                Telegram.WebApp.close();
                            } catch (e) {
                                console.log('–û—à–∏–±–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è:', e);
                            }
                        }, 300);
                    } else {
                        console.log('–¢–µ—Å—Ç: –¥–∞–Ω–Ω—ã–µ –≥–æ—Ç–æ–≤—ã', data);
                        alert('‚úÖ –ü—É–Ω–∫—Ç –≤—ã–±—Ä–∞–Ω! –í Telegram –¥–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤—è—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.');
                    }
                });
                
                // –°–∫—Ä—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
                setTimeout(() => {
                    document.getElementById('loading').style.display = 'none';
                }, 1500);
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞:', error);
                document.getElementById('loading').textContent = '–û—à–∏–±–∫–∞: ' + error.message;
            }
        }
        
        // –ó–∞–ø—É—Å–∫
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ –ó–∞–ø—É—Å–∫...');
            initTelegram();
            initYandexWidget();
        });
    </script>
</body>
</html>
