<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–í—ã–±–æ—Ä –ø—É–Ω–∫—Ç–∞ –≤—ã–¥–∞—á–∏</title>
    
    <!-- –Ø–Ω–¥–µ–∫—Å –≤–∏–¥–∂–µ—Ç -->
    <script src="https://ndd-widget.landpro.site/widget.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            height: 100vh;
            overflow: hidden;
            background: white;
        }
        
        /* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */
        .header {
            background: white;
            padding: 16px;
            text-align: center;
            border-bottom: 1px solid #e0e0e0;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }
        
        .header h1 {
            font-size: 18px;
            color: #333;
            margin-bottom: 4px;
        }
        
        .header p {
            font-size: 14px;
            color: #666;
        }
        
        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–∞—Ä—Ç—ã */
        .map-container {
            position: fixed;
            top: 80px;
            left: 0;
            right: 0;
            bottom: 0;
        }
        
        #widget-container {
            width: 100%;
            height: 100%;
        }
        
        /* –°–∫—Ä—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É */
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 16px;
            color: #666;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        /* –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ */
        .error {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>–í—ã–±–µ—Ä–∏—Ç–µ –ø—É–Ω–∫—Ç –≤—ã–¥–∞—á–∏</h1>
        <p>–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –º–µ—Ç–∫—É –Ω–∞ –∫–∞—Ä—Ç–µ</p>
    </div>
    
    <div class="map-container">
        <div id="widget-container"></div>
        <div class="loading" id="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ä—Ç—ã...</div>
        <div class="error" id="error">
            <h3>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</h3>
            <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É</p>
        </div>
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let isTelegram = false;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        function initTelegram() {
            if (window.Telegram && Telegram.WebApp) {
                isTelegram = true;
                Telegram.WebApp.expand();
                Telegram.WebApp.setHeaderColor('#ffffff');
                Telegram.WebApp.setBackgroundColor('#ffffff');
                Telegram.WebApp.ready();
                console.log('‚úÖ Telegram Web App –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ø–Ω–¥–µ–∫—Å –≤–∏–¥–∂–µ—Ç–∞
        function initYandexWidget() {
            console.log('üîÑ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ø–Ω–¥–µ–∫—Å –≤–∏–¥–∂–µ—Ç–∞...');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –ª–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞
            if (typeof YaDelivery === 'undefined') {
                console.log('‚è≥ –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –Ø–Ω–¥–µ–∫—Å –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞, –∂–¥—ë–º...');
                
                // –ñ–¥–µ–º —Å–æ–±—ã—Ç–∏—è –∑–∞–≥—Ä—É–∑–∫–∏
                document.addEventListener('YaNddWidgetLoad', createYandexWidget);
                
                // –¢–∞–π–º–∞—É—Ç
                setTimeout(function() {
                    if (document.getElementById('loading').style.display !== 'none') {
                        document.getElementById('loading').textContent = '–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–∞—Å—å';
                        console.error('–¢–∞–π–º–∞—É—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –Ø–Ω–¥–µ–∫—Å');
                    }
                }, 10000);
                
                return;
            }
            
            console.log('‚úÖ –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –Ø–Ω–¥–µ–∫—Å –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            createYandexWidget();
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏–¥–∂–µ—Ç–∞ –Ø–Ω–¥–µ–∫—Å
        function createYandexWidget() {
            console.log('üõ†Ô∏è –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏–¥–∂–µ—Ç–∞...');
            
            try {
                // –í–ê–ñ–ù–û: –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–Ω–æ–ø–∫–∏ –≤—ã–±–æ—Ä–∞
                window.yandexWidget = YaDelivery.createWidget({
                    containerId: 'widget-container',
                    params: {
                        city: "–ú–æ—Å–∫–≤–∞",
                        size: {
                            height: "100%",
                            width: "100%"
                        },
                        // –≠—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã –¥–ª—è –∫–Ω–æ–ø–∫–∏ –≤—ã–±–æ—Ä–∞
                        show_select_button: true, // –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∫–Ω–æ–ø–∫—É –≤—ã–±–æ—Ä–∞
                        filter: {
                            type: ["pickup_point"], // –¢–æ–ª—å–∫–æ –ø—É–Ω–∫—Ç—ã –≤—ã–¥–∞—á–∏
                            is_yandex_branded: false, // –í—Å–µ –ü–í–ó, –Ω–µ —Ç–æ–ª—å–∫–æ –Ø–Ω–¥–µ–∫—Å
                            payment_methods: ["already_paid", "card_on_receipt"],
                            payment_methods_filter: "or"
                        },
                        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã
                        delivery_price: "300 ‚ÇΩ", // –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ü–µ–Ω–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
                        delivery_term: "2-4 –¥–Ω—è" // –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å—Ä–æ–∫
                    }
                });
                
                console.log('‚úÖ –í–∏–¥–∂–µ—Ç –Ø–Ω–¥–µ–∫—Å —Å–æ–∑–¥–∞–Ω');
                
                // –°–ª—É—à–∞–µ–º —Å–æ–±—ã—Ç–∏–µ –≤—ã–±–æ—Ä–∞ –ü–í–ó
                document.addEventListener('YaNddWidgetPointSelected', handlePVZSelection);
                
                // –°–∫—Ä—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
                setTimeout(function() {
                    document.getElementById('loading').style.display = 'none';
                    console.log('‚úÖ –ö–∞—Ä—Ç–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞');
                }, 2000);
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –≤–∏–¥–∂–µ—Ç–∞:', error);
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').style.display = 'block';
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ –ü–í–ó
        function handlePVZSelection(event) {
            console.log('üìç –°–æ–±—ã—Ç–∏–µ –≤—ã–±–æ—Ä–∞ –ü–í–ó:', event);
            
            if (!event || !event.detail) {
                console.error('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º –ü–í–ó');
                return;
            }
            
            const pvz = event.detail;
            console.log('üì¶ –î–∞–Ω–Ω—ã–µ –ü–í–ó:', pvz);
            
            // –§–æ—Ä–º–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
            const data = {
                action: 'pvz_selected',
                pvz_id: pvz.id || '',
                pvz_name: pvz.name || '–ü—É–Ω–∫—Ç –≤—ã–¥–∞—á–∏',
                pvz_address: pvz.address?.full_address || '',
                pvz_working_hours: pvz.working_hours || '',
                pvz_phone: pvz.phone || '',
                timestamp: new Date().toISOString()
            };
            
            console.log('üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö:', data);
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ Telegram
            if (isTelegram && window.Telegram && Telegram.WebApp) {
                try {
                    Telegram.WebApp.sendData(JSON.stringify(data));
                    console.log('‚úÖ –î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ Telegram');
                    
                    // –ó–∞–∫—Ä—ã–≤–∞–µ–º Web App –±–µ–∑ –∞–ª–µ—Ä—Ç–æ–≤
                    setTimeout(function() {
                        try {
                            Telegram.WebApp.close();
                        } catch (closeError) {
                            console.log('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏:', closeError);
                        }
                    }, 500);
                    
                } catch (sendError) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏:', sendError);
                    // –ü—Ä–æ—Å—Ç–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –±–µ–∑ JSON
                    alert('‚úÖ –ü—É–Ω–∫—Ç –≤—ã–¥–∞—á–∏ –≤—ã–±—Ä–∞–Ω! –í–æ–∑–≤—Ä–∞—â–∞–π—Ç–µ—Å—å –≤ –±–æ—Ç–∞.');
                }
            } else {
                // –†–µ–∂–∏–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ
                console.log('üìã –î–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ (—Ç–µ—Å—Ç):', data);
                // –ü—Ä–æ—Å—Ç–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –±–µ–∑ JSON
                alert('‚úÖ –ü—É–Ω–∫—Ç –≤—ã–¥–∞—á–∏ –≤—ã–±—Ä–∞–Ω! –í —Ä–µ–∞–ª—å–Ω–æ–º —Ä–µ–∂–∏–º–µ –¥–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤—è—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.');
            }
        }
        
        // –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ –ó–∞–ø—É—Å–∫ Web App...');
            
            initTelegram();
            initYandexWidget();
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥" –≤ Telegram
            if (window.Telegram && Telegram.WebApp && Telegram.WebApp.BackButton) {
                Telegram.WebApp.BackButton.show();
                Telegram.WebApp.BackButton.onClick(function() {
                    Telegram.WebApp.close();
                });
            }
        });
        
        // –ñ–¥–µ–º –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('load', function() {
            console.log('üìÑ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
        });
    </script>
</body>
</html>
