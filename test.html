<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Web App Test</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            text-align: center;
        }
        button {
            padding: 15px 30px;
            font-size: 18px;
            margin: 10px;
            background: #0088cc;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
        }
        #status {
            margin-top: 20px;
            padding: 15px;
            background: #f0f0f0;
            border-radius: 10px;
            text-align: left;
        }
    </style>
</head>
<body>
    <h1>Telegram Web App Test</h1>
    <p>–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã Web App –≤ Telegram</p>
    
    <button onclick="sendTestData()">üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
    <button onclick="checkTelegram()">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Telegram</button>
    
    <div id="status">–°—Ç–∞—Ç—É—Å: –æ–∂–∏–¥–∞–Ω–∏–µ...</div>

    <script>
        let status = document.getElementById('status');
        
        function log(message) {
            console.log(message);
            status.innerHTML += message + '<br>';
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º Telegram Web App
        function checkTelegram() {
            log('--- –ü—Ä–æ–≤–µ—Ä–∫–∞ Telegram ---');
            
            if (window.Telegram) {
                log('‚úÖ window.Telegram —Å—É—â–µ—Å—Ç–≤—É–µ—Ç');
                
                if (Telegram.WebApp) {
                    log('‚úÖ Telegram.WebApp —Å—É—â–µ—Å—Ç–≤—É–µ—Ç');
                    log(`–í–µ—Ä—Å–∏—è: ${Telegram.WebApp.version}`);
                    log(`–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞: ${Telegram.WebApp.platform}`);
                    log(`–ò–Ω–∏—Ü–∏–∞—Ç–æ—Ä: ${Telegram.WebApp.initData}`);
                    
                    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º
                    Telegram.WebApp.expand();
                    Telegram.WebApp.ready();
                    log('‚úÖ Web App –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
                } else {
                    log('‚ùå Telegram.WebApp –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç');
                }
            } else {
                log('‚ùå window.Telegram –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç');
                log('–≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ—Ç–æ–º—É —á—Ç–æ:');
                log('1. –°—Ç—Ä–∞–Ω–∏—Ü–∞ –æ—Ç–∫—Ä—ã—Ç–∞ –Ω–µ –≤ Telegram');
                log('2. Telegram –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª —Å–∫—Ä–∏–ø—Ç');
                log('3. –ü—Ä–æ–±–ª–µ–º–∞ —Å HTTPS');
            }
        }
        
        // –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö
        function sendTestData() {
            log('--- –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö ---');
            
            if (!window.Telegram || !Telegram.WebApp) {
                log('‚ùå Telegram Web App –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω');
                return;
            }
            
            const testData = {
                action: 'test_from_webapp',
                message: '–ü—Ä–∏–≤–µ—Ç –∏–∑ Telegram Web App!',
                timestamp: new Date().toISOString(),
                user_id: Telegram.WebApp.initDataUnsafe?.user?.id || 'unknown'
            };
            
            log(`–û—Ç–ø—Ä–∞–≤–∫–∞: ${JSON.stringify(testData)}`);
            
            try {
                Telegram.WebApp.sendData(JSON.stringify(testData));
                log('‚úÖ –î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ sendData()');
                
                setTimeout(() => {
                    Telegram.WebApp.close();
                    log('‚úÖ Web App –∑–∞–∫—Ä—ã—Ç');
                }, 1000);
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`);
            }
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', function() {
            log('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            setTimeout(checkTelegram, 500);
        });
    </script>
</body>
</html>
